<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pulsar — Spatial LED Mapping</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
  :root {
    --bg: #000;
    --bg2: #0a0a0a;
    --text: #f5f5f7;
    --text2: #86868b;
    --text3: #6e6e73;
    --accent: #2997ff;
    --red: #ff375f;
    --green: #30d158;
    --blue: #0a84ff;
    --purple: #bf5af2;
    --orange: #ff9f0a;
    --cyan: #64d2ff;
    --mono: 'SF Mono', 'Fira Code', 'Cascadia Code', monospace;
    --sans: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { scroll-behavior: smooth; }
  body { background: var(--bg); color: var(--text); font-family: var(--sans); -webkit-font-smoothing: antialiased; overflow-x: hidden; }

  /* ── Nav ─────────────────────────────── */
  nav {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);
    background: rgba(0,0,0,0.72); border-bottom: 1px solid rgba(255,255,255,0.08);
    display: flex; justify-content: center; align-items: center; gap: 32px;
    padding: 0 24px; height: 48px; font-size: 0.8rem;
  }
  nav a { color: var(--text2); text-decoration: none; transition: color 0.2s; }
  nav a:hover { color: var(--text); }
  nav .brand { font-weight: 700; color: var(--text); font-size: 0.9rem; letter-spacing: -0.02em; }

  /* ── Sections ────────────────────────── */
  section { padding: 120px 24px; position: relative; overflow: hidden; }
  .container { max-width: 980px; margin: 0 auto; }
  .wide { max-width: 1200px; margin: 0 auto; }

  /* ── Hero ─────────────────────────────── */
  .hero { min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding-top: 48px; }
  .hero h1 {
    font-size: clamp(3rem, 8vw, 6rem); font-weight: 800; letter-spacing: -0.04em; line-height: 1.05;
    background: linear-gradient(135deg, #fff 0%, #64d2ff 40%, #0a84ff 60%, #bf5af2 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    margin-bottom: 20px;
  }
  .hero p { font-size: clamp(1.1rem, 2vw, 1.4rem); color: var(--text2); max-width: 640px; line-height: 1.5; font-weight: 300; }
  .hero-visual { margin-top: 60px; position: relative; width: 100%; max-width: 800px; }

  /* ── LED Tree Animation ──────────────── */
  .tree-wrap { position: relative; width: 100%; height: 420px; }
  .tree-wrap svg { width: 100%; height: 100%; }
  .led-dot {
    r: 4; fill: #fff; opacity: 0;
    animation: ledFade 3s ease-in-out infinite;
  }
  @keyframes ledFade { 0%,100% { opacity: 0.2; } 50% { opacity: 1; } }
  .led-dot:nth-child(3n)   { animation-delay: 0s; }
  .led-dot:nth-child(3n+1) { animation-delay: 1s; }
  .led-dot:nth-child(3n+2) { animation-delay: 2s; }
  .led-dot.c-red   { fill: var(--red); }
  .led-dot.c-green { fill: var(--green); }
  .led-dot.c-blue  { fill: var(--blue); }
  .led-dot.c-white { fill: #fff; }

  /* ── Section Headers ─────────────────── */
  .section-eyebrow { font-size: 0.85rem; font-weight: 600; color: var(--accent); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 12px; }
  .section-title { font-size: clamp(2rem, 5vw, 3.2rem); font-weight: 700; letter-spacing: -0.03em; line-height: 1.1; margin-bottom: 16px; }
  .section-subtitle { font-size: clamp(1rem, 2vw, 1.25rem); color: var(--text2); line-height: 1.6; max-width: 640px; font-weight: 300; }
  .centered { text-align: center; display: flex; flex-direction: column; align-items: center; }

  /* ── Feature Grid ────────────────────── */
  .features { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-top: 56px; }
  @media (max-width: 700px) { .features { grid-template-columns: 1fr; } }
  .feature-card {
    background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06);
    border-radius: 20px; padding: 36px 28px; transition: all 0.3s;
  }
  .feature-card:hover { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.1); transform: translateY(-2px); }
  .feature-icon { font-size: 2rem; margin-bottom: 16px; display: block; }
  .feature-card h3 { font-size: 1.15rem; font-weight: 600; margin-bottom: 8px; }
  .feature-card p { font-size: 0.88rem; color: var(--text2); line-height: 1.55; }

  /* ── How It Works Steps ──────────────── */
  .steps { margin-top: 64px; }
  .step {
    display: grid; grid-template-columns: 1fr 1fr; gap: 48px; align-items: center;
    padding: 64px 0; border-top: 1px solid rgba(255,255,255,0.06);
  }
  .step:nth-child(even) .step-visual { order: -1; }
  @media (max-width: 800px) {
    .step { grid-template-columns: 1fr; gap: 32px; }
    .step:nth-child(even) .step-visual { order: 0; }
  }
  .step-num { font-size: 0.7rem; font-weight: 700; color: var(--accent); font-family: var(--mono); letter-spacing: 0.1em; margin-bottom: 12px; }
  .step h3 { font-size: 1.6rem; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 12px; }
  .step p { font-size: 0.95rem; color: var(--text2); line-height: 1.65; }
  .step-visual {
    background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06);
    border-radius: 16px; aspect-ratio: 4/3; display: flex; align-items: center; justify-content: center;
    overflow: hidden; position: relative;
  }

  /* ── Protocol Animation ──────────────── */
  .protocol-anim { padding: 24px; width: 100%; }
  .symbol-stream {
    display: flex; gap: 6px; align-items: center; justify-content: center;
    margin-bottom: 16px; flex-wrap: wrap;
  }
  .sym {
    width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center;
    font-size: 0.6rem; font-weight: 700; font-family: var(--mono); color: #000;
    animation: symPulse 4s ease-in-out infinite;
    opacity: 0.3;
  }
  .sym.active { opacity: 1; transform: scale(1.1); box-shadow: 0 0 20px var(--sym-color); }
  .sym-w { background: #fff; --sym-color: rgba(255,255,255,0.5); }
  .sym-r { background: var(--red); --sym-color: rgba(255,55,95,0.5); color: #fff; }
  .sym-g { background: var(--green); --sym-color: rgba(48,209,88,0.5); }
  .sym-b { background: var(--blue); --sym-color: rgba(10,132,255,0.5); color: #fff; }
  @keyframes symPulse {
    0%, 100% { opacity: 0.25; transform: scale(1); box-shadow: none; }
    15%, 35% { opacity: 1; transform: scale(1.08); }
  }
  .sym:nth-child(1)  { animation-delay: 0s; }
  .sym:nth-child(2)  { animation-delay: 0.3s; }
  .sym:nth-child(3)  { animation-delay: 0.6s; }
  .sym:nth-child(4)  { animation-delay: 0.9s; }
  .sym:nth-child(5)  { animation-delay: 1.2s; }
  .sym:nth-child(6)  { animation-delay: 1.5s; }
  .sym:nth-child(7)  { animation-delay: 1.8s; }
  .sym:nth-child(8)  { animation-delay: 2.1s; }
  .sym:nth-child(9)  { animation-delay: 2.4s; }
  .sym:nth-child(10) { animation-delay: 2.7s; }
  .sym:nth-child(11) { animation-delay: 3.0s; }
  .sym:nth-child(12) { animation-delay: 3.3s; }
  .proto-label {
    display: flex; justify-content: center; gap: 16px; font-size: 0.65rem; color: var(--text3);
    font-family: var(--mono); flex-wrap: wrap;
  }
  .proto-label span { display: flex; align-items: center; gap: 4px; }
  .proto-label .dot { width: 8px; height: 8px; border-radius: 2px; }

  /* ── Detection Pipeline Viz ──────────── */
  .detect-viz { width: 100%; padding: 20px; }
  .pipe-row { display: flex; align-items: center; justify-content: center; gap: 4px; flex-wrap: wrap; }
  .pipe-box {
    padding: 8px 12px; border-radius: 8px; font-size: 0.65rem; font-weight: 600; font-family: var(--mono);
    background: rgba(100,210,255,0.08); border: 1px solid rgba(100,210,255,0.2); color: var(--cyan);
    white-space: nowrap;
  }
  .pipe-arr { color: var(--text3); font-size: 0.7rem; }

  /* ── Tracking Viz ────────────────────── */
  .track-viz { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
  .track-dot {
    position: absolute; width: 16px; height: 16px; border-radius: 50%; border: 2px solid;
    animation: trackMove 6s ease-in-out infinite;
  }
  .track-dot::after {
    content: attr(data-id); position: absolute; top: -18px; left: 50%; transform: translateX(-50%);
    font-size: 0.55rem; font-family: var(--mono); font-weight: 600; white-space: nowrap;
  }
  .td1 { border-color: var(--green); left: 20%; top: 30%; animation-delay: 0s; }
  .td1::after { color: var(--green); }
  .td2 { border-color: var(--blue); left: 50%; top: 50%; animation-delay: 1s; }
  .td2::after { color: var(--blue); }
  .td3 { border-color: var(--orange); left: 70%; top: 25%; animation-delay: 2s; }
  .td3::after { color: var(--orange); }
  .td4 { border-color: var(--purple); left: 35%; top: 65%; animation-delay: 0.5s; }
  .td4::after { color: var(--purple); }
  .td5 { border-color: var(--red); left: 60%; top: 70%; animation-delay: 1.5s; }
  .td5::after { color: var(--red); }
  @keyframes trackMove {
    0%, 100% { transform: translate(0, 0); }
    25% { transform: translate(10px, -8px); }
    50% { transform: translate(18px, -4px); }
    75% { transform: translate(8px, 4px); }
  }
  .track-ring {
    position: absolute; width: 24px; height: 24px; border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.15); top: -4px; left: -4px;
    animation: ringPulse 2s ease-out infinite;
  }
  @keyframes ringPulse { 0% { transform: scale(1); opacity: 0.6; } 100% { transform: scale(2.5); opacity: 0; } }

  /* ── Color Wheel Viz ─────────────────── */
  .wheel-viz { padding: 24px; text-align: center; }
  .wheel-svg { width: 200px; height: 200px; }
  .wheel-arc { fill: none; stroke-width: 28; stroke-linecap: round; }
  .wheel-arrow { animation: wheelSpin 4s ease-in-out infinite; transform-origin: 100px 100px; }
  @keyframes wheelSpin { 0%, 100% { transform: rotate(0deg); } 33% { transform: rotate(120deg); } 66% { transform: rotate(240deg); } }
  .wheel-label-below { font-size: 0.7rem; color: var(--text3); margin-top: 12px; font-family: var(--mono); }

  /* ── Stats Row ───────────────────────── */
  .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; margin-top: 56px; text-align: center; }
  @media (max-width: 600px) { .stats { grid-template-columns: repeat(2, 1fr); } }
  .stat-num { font-size: clamp(2rem, 4vw, 3rem); font-weight: 800; letter-spacing: -0.03em; }
  .stat-num.grad { background: linear-gradient(135deg, var(--cyan), var(--blue)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .stat-label { font-size: 0.8rem; color: var(--text3); margin-top: 4px; }

  /* ── Architecture Link ───────────────── */
  .arch-link {
    display: inline-flex; align-items: center; gap: 8px; margin-top: 32px;
    padding: 12px 28px; border-radius: 980px;
    background: rgba(41,151,255,0.12); border: 1px solid rgba(41,151,255,0.3);
    color: var(--accent); font-size: 0.9rem; font-weight: 500; text-decoration: none;
    transition: all 0.25s;
  }
  .arch-link:hover { background: rgba(41,151,255,0.2); border-color: var(--accent); transform: translateY(-1px); }
  .arch-link svg { width: 16px; height: 16px; }

  /* ── Pipeline Section ────────────────── */
  .pipeline-full {
    display: flex; flex-direction: column; align-items: center; gap: 0;
    margin-top: 48px;
  }
  .pl-node {
    background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08);
    border-radius: 14px; padding: 20px 28px; text-align: center; width: 100%; max-width: 400px;
    transition: all 0.3s;
  }
  .pl-node:hover { background: rgba(255,255,255,0.06); border-color: rgba(255,255,255,0.15); }
  .pl-node h4 { font-size: 0.95rem; font-weight: 600; margin-bottom: 4px; }
  .pl-node .pl-type { font-size: 0.68rem; font-family: var(--mono); color: var(--text3); }
  .pl-conn { width: 2px; height: 32px; background: rgba(255,255,255,0.08); position: relative; }
  .pl-conn::after {
    content: ''; position: absolute; bottom: -1px; left: -3px;
    border-left: 4px solid transparent; border-right: 4px solid transparent;
    border-top: 5px solid rgba(255,255,255,0.15);
  }

  /* ── Code Block ──────────────────────── */
  .code-showcase {
    background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06);
    border-radius: 16px; padding: 24px 28px; font-family: var(--mono); font-size: 0.78rem;
    line-height: 1.8; overflow-x: auto; margin-top: 32px;
  }
  .code-showcase .kw { color: var(--purple); }
  .code-showcase .ty { color: var(--cyan); }
  .code-showcase .fn { color: var(--green); }
  .code-showcase .cm { color: var(--text3); }
  .code-showcase .str { color: var(--orange); }

  /* ── Footer ──────────────────────────── */
  footer {
    border-top: 1px solid rgba(255,255,255,0.06); padding: 40px 24px; text-align: center;
    font-size: 0.78rem; color: var(--text3);
  }
  footer a { color: var(--text2); text-decoration: none; }
  footer a:hover { color: var(--text); }
  footer .links { display: flex; justify-content: center; gap: 24px; margin-bottom: 12px; }

  /* ── Divider ─────────────────────────── */
  .divider { height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.06), transparent); margin: 0 auto; max-width: 800px; }

  /* ── Scroll Fade ─────────────────────── */
  .fade-in { opacity: 0; transform: translateY(30px); transition: all 0.7s cubic-bezier(0.16, 1, 0.3, 1); }
  .fade-in.visible { opacity: 1; transform: translateY(0); }
</style>
</head>
<body>

<nav>
  <a href="#" class="brand">Pulsar</a>
  <a href="#how-it-works">How It Works</a>
  <a href="#pipeline">Pipeline</a>
  <a href="#protocol">Protocol</a>
  <a href="system-diagram.html">Architecture</a>
  <a href="spec.html">Spec</a>
</nav>

<!-- ═══════════════════════════════════════ -->
<!--  HERO                                  -->
<!-- ═══════════════════════════════════════ -->
<section class="hero">
  <h1>Map light<br>in space.</h1>
  <p>Pulsar identifies and locates every LED on a string by watching them flash. Point your iPhone, walk around, and get a 3D spatial map of your entire LED installation.</p>

  <div class="hero-visual">
    <div class="tree-wrap">
      <svg viewBox="0 0 800 420" fill="none">
        <!-- Tree silhouette -->
        <path d="M400 40 L320 140 L340 140 L260 240 L290 240 L220 340 L580 340 L510 240 L540 240 L460 140 L480 140 Z" fill="rgba(255,255,255,0.02)" stroke="rgba(255,255,255,0.04)" stroke-width="1"/>
        <rect x="375" y="340" width="50" height="40" rx="4" fill="rgba(255,255,255,0.03)"/>

        <!-- LED dots scattered on tree -->
        <circle class="led-dot c-red"   cx="370" cy="80"  style="animation-delay:0.0s"/>
        <circle class="led-dot c-green" cx="420" cy="90"  style="animation-delay:0.4s"/>
        <circle class="led-dot c-blue"  cx="340" cy="130" style="animation-delay:0.8s"/>
        <circle class="led-dot c-white" cx="450" cy="120" style="animation-delay:1.2s"/>
        <circle class="led-dot c-red"   cx="380" cy="150" style="animation-delay:0.2s"/>
        <circle class="led-dot c-green" cx="310" cy="170" style="animation-delay:0.6s"/>
        <circle class="led-dot c-blue"  cx="460" cy="160" style="animation-delay:1.0s"/>
        <circle class="led-dot c-red"   cx="350" cy="200" style="animation-delay:1.4s"/>
        <circle class="led-dot c-green" cx="420" cy="190" style="animation-delay:0.3s"/>
        <circle class="led-dot c-white" cx="280" cy="220" style="animation-delay:0.7s"/>
        <circle class="led-dot c-blue"  cx="490" cy="210" style="animation-delay:1.1s"/>
        <circle class="led-dot c-red"   cx="330" cy="250" style="animation-delay:1.5s"/>
        <circle class="led-dot c-green" cx="400" cy="240" style="animation-delay:0.5s"/>
        <circle class="led-dot c-blue"  cx="470" cy="250" style="animation-delay:0.9s"/>
        <circle class="led-dot c-white" cx="300" cy="270" style="animation-delay:1.3s"/>
        <circle class="led-dot c-red"   cx="520" cy="270" style="animation-delay:0.1s"/>
        <circle class="led-dot c-green" cx="360" cy="290" style="animation-delay:1.6s"/>
        <circle class="led-dot c-blue"  cx="440" cy="300" style="animation-delay:0.45s"/>
        <circle class="led-dot c-red"   cx="260" cy="310" style="animation-delay:0.85s"/>
        <circle class="led-dot c-green" cx="540" cy="310" style="animation-delay:1.25s"/>
        <circle class="led-dot c-blue"  cx="330" cy="320" style="animation-delay:1.65s"/>
        <circle class="led-dot c-white" cx="470" cy="325" style="animation-delay:0.35s"/>

        <!-- Camera icon -->
        <g transform="translate(640, 300)">
          <rect x="0" y="0" width="48" height="36" rx="8" fill="rgba(255,255,255,0.06)" stroke="rgba(255,255,255,0.15)" stroke-width="1"/>
          <circle cx="24" cy="18" r="10" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="1.5"/>
          <circle cx="24" cy="18" r="4" fill="rgba(41,151,255,0.3)"/>
          <!-- Scan lines -->
          <line x1="-20" y1="18" x2="0" y2="18" stroke="rgba(41,151,255,0.15)" stroke-width="0.5" stroke-dasharray="3 2">
            <animate attributeName="x1" values="-80;-20" dur="2s" repeatCount="indefinite"/>
            <animate attributeName="opacity" values="0;1;0" dur="2s" repeatCount="indefinite"/>
          </line>
        </g>
      </svg>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- ═══════════════════════════════════════ -->
<!--  STATS                                 -->
<!-- ═══════════════════════════════════════ -->
<section>
  <div class="container">
    <div class="stats fade-in">
      <div>
        <div class="stat-num grad">900+</div>
        <div class="stat-label">LEDs mapped per session</div>
      </div>
      <div>
        <div class="stat-num grad">2.2s</div>
        <div class="stat-label">Per-LED decode time</div>
      </div>
      <div>
        <div class="stat-num grad">30fps</div>
        <div class="stat-label">Real-time processing</div>
      </div>
      <div>
        <div class="stat-num grad">0</div>
        <div class="stat-label">Hardware modifications</div>
      </div>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- ═══════════════════════════════════════ -->
<!--  FEATURES                              -->
<!-- ═══════════════════════════════════════ -->
<section>
  <div class="container">
    <div class="centered fade-in">
      <div class="section-eyebrow">Why Pulsar</div>
      <h2 class="section-title">Every LED, identified.<br>Every position, mapped.</h2>
      <p class="section-subtitle">Pulsar turns an ordinary iPhone into a spatial LED scanner. No special hardware, no manual numbering, no firmware modifications. Just light and math.</p>
    </div>
    <div class="features fade-in">
      <div class="feature-card">
        <span class="feature-icon">&#x1F4A1;</span>
        <h3>Works with WLED</h3>
        <p>Connects to any WLED controller over Wi-Fi. Automatic device discovery via mDNS. Send one DDP packet and every LED starts transmitting its identity.</p>
      </div>
      <div class="feature-card">
        <span class="feature-icon">&#x1F3AF;</span>
        <h3>Computer Vision Pipeline</h3>
        <p>GPU-accelerated detection with connected component labeling, eccentricity filtering, and adaptive thresholding. Tracks hundreds of candidates simultaneously at full frame rate.</p>
      </div>
      <div class="feature-card">
        <span class="feature-icon">&#x1F510;</span>
        <h3>Error-Corrected Protocol</h3>
        <p>RGB differential phase encoding puts data in color transitions, not absolute values. Immune to frame rate variation and exposure drift. CRC-8 catches every corruption.</p>
      </div>
      <div class="feature-card">
        <span class="feature-icon">&#x1F4F1;</span>
        <h3>Real-Time Debug UI</h3>
        <p>See every track, every symbol, every state transition live. Tap a track to see its full decode history. Every parameter is adjustable with live sliders.</p>
      </div>
      <div class="feature-card">
        <span class="feature-icon">&#x1F9E9;</span>
        <h3>Pluggable Architecture</h3>
        <p>Detection, tracking, and encoding are all protocol-based. Swap a spatial hash matcher for Vision framework tracking with one line. Run bake-offs between strategies.</p>
      </div>
      <div class="feature-card">
        <span class="feature-icon">&#x1F9EA;</span>
        <h3>Test-Driven Throughout</h3>
        <p>136+ tests with synthetic frame simulation, annotated video artifacts, and zero hardware dependencies. Every component testable with <code style="font-family:var(--mono);background:rgba(255,255,255,0.06);padding:1px 5px;border-radius:3px;font-size:0.8rem;">swift test</code>.</p>
      </div>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- ═══════════════════════════════════════ -->
<!--  HOW IT WORKS                          -->
<!-- ═══════════════════════════════════════ -->
<section id="how-it-works">
  <div class="container">
    <div class="centered fade-in">
      <div class="section-eyebrow">How It Works</div>
      <h2 class="section-title">From photons<br>to coordinates.</h2>
      <p class="section-subtitle">Each LED flashes a unique encoded sequence. The iPhone camera reads the flashes, classifies the colors, and decodes the identity of every LED it sees.</p>
    </div>

    <div class="steps">
      <!-- Step 1: Encode -->
      <div class="step fade-in">
        <div>
          <div class="step-num">STEP 01 &mdash; ENCODE</div>
          <h3>Every LED gets an address</h3>
          <p>The WLED controller encodes each LED's ID into a sequence of color flashes. Data lives in the <em>direction</em> of color transitions &mdash; Red to Green is a "1", Red to Blue is a "0". Because data is in transitions, not timing, repeated frames are harmlessly ignored.</p>
        </div>
        <div class="step-visual">
          <div class="wheel-viz">
            <svg class="wheel-svg" viewBox="0 0 200 200">
              <circle class="wheel-arc" cx="100" cy="100" r="72" stroke="rgba(255,55,95,0.3)" stroke-dasharray="75.4 226.2" stroke-dashoffset="0"/>
              <circle class="wheel-arc" cx="100" cy="100" r="72" stroke="rgba(48,209,88,0.3)" stroke-dasharray="75.4 226.2" stroke-dashoffset="-150.8"/>
              <circle class="wheel-arc" cx="100" cy="100" r="72" stroke="rgba(10,132,255,0.3)" stroke-dasharray="75.4 226.2" stroke-dashoffset="-301.6"/>
              <text x="100" y="28" text-anchor="middle" fill="var(--red)" font-size="11" font-weight="600" font-family="Inter, sans-serif">R</text>
              <text x="168" y="145" text-anchor="middle" fill="var(--green)" font-size="11" font-weight="600" font-family="Inter, sans-serif">G</text>
              <text x="32" y="145" text-anchor="middle" fill="var(--blue)" font-size="11" font-weight="600" font-family="Inter, sans-serif">B</text>
              <!-- CW arrow -->
              <g class="wheel-arrow">
                <path d="M128 44 L140 55 L125 55" fill="none" stroke="var(--green)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </g>
              <text x="100" y="95" text-anchor="middle" fill="var(--text3)" font-size="8" font-family="Inter, sans-serif">CW = 1</text>
              <text x="100" y="110" text-anchor="middle" fill="var(--text3)" font-size="8" font-family="Inter, sans-serif">CCW = 0</text>
            </svg>
            <div class="wheel-label-below">RGB Differential Phase Encoding</div>
          </div>
        </div>
      </div>

      <!-- Step 2: Detect -->
      <div class="step fade-in">
        <div>
          <div class="step-num">STEP 02 &mdash; DETECT</div>
          <h3>Find every bright dot</h3>
          <p>Each camera frame runs through a GPU-accelerated pipeline: downsample, extract max brightness channel, filter noise, threshold, morphological cleanup, then connected component labeling. The result: precise centroids and shapes for every LED candidate in the frame.</p>
        </div>
        <div class="step-visual">
          <div class="detect-viz">
            <div class="pipe-row">
              <div class="pipe-box">Downsample</div>
              <div class="pipe-arr">&rarr;</div>
              <div class="pipe-box">Max Channel</div>
              <div class="pipe-arr">&rarr;</div>
              <div class="pipe-box">Median</div>
              <div class="pipe-arr">&rarr;</div>
              <div class="pipe-box">Threshold</div>
            </div>
            <div style="height:12px;"></div>
            <div class="pipe-row">
              <div class="pipe-box">Morphology</div>
              <div class="pipe-arr">&rarr;</div>
              <div class="pipe-box">CCL</div>
              <div class="pipe-arr">&rarr;</div>
              <div class="pipe-box">Shape Filter</div>
              <div class="pipe-arr">&rarr;</div>
              <div class="pipe-box" style="background:rgba(48,209,88,0.08);border-color:rgba(48,209,88,0.2);color:var(--green);">Candidates</div>
            </div>
            <div style="text-align:center;margin-top:16px;font-size:0.68rem;color:var(--text3);font-family:var(--mono);">
              Eccentricity filtering rejects merged blobs (e &gt; 0.85)
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Track -->
      <div class="step fade-in">
        <div>
          <div class="step-num">STEP 03 &mdash; TRACK</div>
          <h3>Follow each LED across frames</h3>
          <p>Detected candidates are matched to persistent tracks using a spatial hash grid with velocity prediction. When the camera pans, search radii expand automatically. A nursery stage filters noise by requiring 3 consecutive detections before creating a track.</p>
        </div>
        <div class="step-visual">
          <div class="track-viz">
            <div class="track-dot td1" data-id="LED #42"><div class="track-ring"></div></div>
            <div class="track-dot td2" data-id="LED #187"><div class="track-ring" style="animation-delay:0.5s"></div></div>
            <div class="track-dot td3" data-id="LED #3"><div class="track-ring" style="animation-delay:1s"></div></div>
            <div class="track-dot td4" data-id="LED #511"><div class="track-ring" style="animation-delay:0.3s"></div></div>
            <div class="track-dot td5" data-id="LED #899"><div class="track-ring" style="animation-delay:0.8s"></div></div>
          </div>
        </div>
      </div>

      <!-- Step 4: Decode -->
      <div class="step fade-in">
        <div>
          <div class="step-num">STEP 04 &mdash; DECODE</div>
          <h3>Read the address from flashes</h3>
          <p>Each track holds its own decoder state machine. Color samples are classified into symbols, duplicates are filtered, and the preamble syncs the decoder. Header, address, and CRC bits are extracted from color transitions. A correct CRC confirms the LED's identity.</p>
        </div>
        <div class="step-visual">
          <div class="protocol-anim">
            <div class="symbol-stream">
              <div class="sym sym-w">W</div>
              <div class="sym sym-r">R</div>
              <div class="sym sym-g">G</div>
              <div class="sym sym-b">B</div>
              <div class="sym sym-w">W</div>
              <div class="sym sym-r" style="opacity:0.6;">1</div>
              <div class="sym sym-g" style="opacity:0.6;">0</div>
              <div class="sym sym-b" style="opacity:0.6;">1</div>
              <div class="sym sym-r" style="opacity:0.6;">1</div>
              <div class="sym sym-b" style="opacity:0.6;">0</div>
              <div class="sym sym-r" style="opacity:0.6;">1</div>
              <div class="sym sym-g" style="opacity:0.6;">0</div>
            </div>
            <div class="proto-label">
              <span><span class="dot" style="background:#fff;"></span> Preamble</span>
              <span><span class="dot" style="background:var(--cyan);"></span> Header</span>
              <span><span class="dot" style="background:var(--green);"></span> Address</span>
              <span><span class="dot" style="background:var(--orange);"></span> CRC</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- ═══════════════════════════════════════ -->
<!--  PIPELINE OVERVIEW                     -->
<!-- ═══════════════════════════════════════ -->
<section id="pipeline" style="background: var(--bg2);">
  <div class="container">
    <div class="centered fade-in">
      <div class="section-eyebrow">Pipeline</div>
      <h2 class="section-title">Protocols all the way down.</h2>
      <p class="section-subtitle">Every layer is a Swift protocol. Implementations are swappable strategies &mdash; compare approaches, run bake-offs, and iterate without touching the rest of the stack.</p>
    </div>

    <div class="pipeline-full fade-in">
      <div class="pl-node" style="border-color: rgba(236,72,153,0.2);">
        <h4>Camera Capture</h4>
        <div class="pl-type">CameraService &rarr; FrameData { CVPixelBuffer, TimeInterval }</div>
      </div>
      <div class="pl-conn"></div>
      <div class="pl-node" style="border-color: rgba(100,210,255,0.2);">
        <h4>LED Detection</h4>
        <div class="pl-type">protocol LEDDetector &rarr; ThresholdDetector</div>
      </div>
      <div class="pl-conn"></div>
      <div class="pl-node" style="border-color: rgba(191,90,242,0.2);">
        <h4>Candidate Nursery</h4>
        <div class="pl-type">CandidateNursery &mdash; 3-frame temporal gate</div>
      </div>
      <div class="pl-conn"></div>
      <div class="pl-node" style="border-color: rgba(191,90,242,0.2);">
        <h4>Track Matching</h4>
        <div class="pl-type">protocol TrackMatcher &rarr; SpatialHash | VisionFramework</div>
      </div>
      <div class="pl-conn"></div>
      <div class="pl-node" style="border-color: rgba(10,132,255,0.2);">
        <h4>Track Management</h4>
        <div class="pl-type">TrackManager.processFrame() &mdash; orchestrator</div>
      </div>
      <div class="pl-conn"></div>
      <div class="pl-node" style="border-color: rgba(255,159,10,0.2);">
        <h4>Symbol Decode</h4>
        <div class="pl-type">protocol EncodingStrategy &rarr; RGBDifferentialPhase</div>
      </div>
      <div class="pl-conn"></div>
      <div class="pl-node" style="border-color: rgba(48,209,88,0.2);">
        <h4>Decoded LED ID</h4>
        <div class="pl-type">Track.decodedID: UInt16 &rarr; TrackSnapshot &rarr; @MainActor</div>
      </div>
      <div class="pl-conn" style="border-style: dashed; background: repeating-linear-gradient(to bottom, rgba(255,255,255,0.04) 0px, rgba(255,255,255,0.04) 4px, transparent 4px, transparent 8px);"></div>
      <div class="pl-node" style="border-style: dashed; border-color: rgba(234,179,8,0.2); opacity: 0.6;">
        <h4>World Model <span style="font-size:0.6rem;font-weight:500;color:var(--orange);">&nbsp;PHASE 5</span></h4>
        <div class="pl-type">protocol WorldModel &rarr; 3D triangulation + ARKit</div>
      </div>
    </div>

    <div class="centered" style="margin-top: 40px;">
      <a href="system-diagram.html" class="arch-link">
        Explore the full architecture
        <svg viewBox="0 0 16 16" fill="none"><path d="M6 3l5 5-5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </a>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- ═══════════════════════════════════════ -->
<!--  PROTOCOL DETAIL                       -->
<!-- ═══════════════════════════════════════ -->
<section id="protocol">
  <div class="container">
    <div class="centered fade-in">
      <div class="section-eyebrow">Protocol Design</div>
      <h2 class="section-title">Data in the transitions.</h2>
      <p class="section-subtitle">RGB Differential Phase encoding puts bit values in the direction of color change, not in the colors themselves. This makes the protocol immune to timing jitter &mdash; if a frame shows the same color twice, it's simply ignored.</p>
    </div>

    <div class="code-showcase fade-in">
      <span class="cm">// The entire encoding strategy is a factory of three protocols:</span><br><br>
      <span class="kw">protocol</span> <span class="ty">EncodingStrategy</span> {<br>
      &nbsp;&nbsp;<span class="kw">func</span> <span class="fn">makeEncoder</span>() -> <span class="ty">SymbolEncoder</span>&nbsp;&nbsp;&nbsp;<span class="cm">// LED ID &rarr; symbol sequence</span><br>
      &nbsp;&nbsp;<span class="kw">func</span> <span class="fn">makeClassifier</span>() -> <span class="ty">SymbolClassifier</span> <span class="cm">// pixel &rarr; symbol</span><br>
      &nbsp;&nbsp;<span class="kw">func</span> <span class="fn">makeDecoder</span>() -> <span class="ty">SymbolDecoder</span>&nbsp;&nbsp;<span class="cm">// symbol stream &rarr; LED ID</span><br>
      }<br><br>
      <span class="cm">// Bit encoding: clockwise = 1, counter-clockwise = 0</span><br>
      <span class="cm">// Red &rarr; Green = 1&emsp;Red &rarr; Blue = 0</span><br>
      <span class="cm">// Duplicate symbols are ignored (hold detection)</span><br>
      <span class="cm">// CRC-8 catches any single-symbol corruption</span>
    </div>

    <div class="centered" style="margin-top: 40px;">
      <a href="spec.html" class="arch-link">
        Read the full specification
        <svg viewBox="0 0 16 16" fill="none"><path d="M6 3l5 5-5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </a>
    </div>
  </div>
</section>

<div class="divider"></div>

<!-- ═══════════════════════════════════════ -->
<!--  PROJECT STRUCTURE                     -->
<!-- ═══════════════════════════════════════ -->
<section style="background: var(--bg2);">
  <div class="container">
    <div class="centered fade-in">
      <div class="section-eyebrow">Project</div>
      <h2 class="section-title">Built for experimentation.</h2>
      <p class="section-subtitle">PLSRKit is a standalone Swift Package with zero platform dependencies. The iOS app and macOS mock transmitter are thin shells. Everything is testable without hardware.</p>
    </div>

    <div class="features fade-in" style="grid-template-columns: 1fr 1fr; margin-top: 48px;">
      <div class="feature-card">
        <span class="feature-icon">&#x1F4E6;</span>
        <h3>PLSRKit</h3>
        <p>The heart. PLSRProtocol (encoding, CRC, packets), PLSRVision (detection, tracking, matching), PLSRCommon (shared types). Runs with <code style="font-family:var(--mono);font-size:0.82rem;background:rgba(255,255,255,0.06);padding:1px 5px;border-radius:3px;">swift test</code>.</p>
      </div>
      <div class="feature-card">
        <span class="feature-icon">&#x1F4F1;</span>
        <h3>PLSRApp</h3>
        <p>iOS thin shell. Camera capture with manual exposure, WLED discovery, DDP network driver, debug overlay with live parameter sliders. SwiftUI + Swift 6 concurrency.</p>
      </div>
      <div class="feature-card">
        <span class="feature-icon">&#x1F5A5;</span>
        <h3>PLSRMock</h3>
        <p>macOS mock transmitter. Renders flashing LED dots on screen for camera-based testing without hardware. Includes timing jitter simulation and realistic glow profiles.</p>
      </div>
      <div class="feature-card">
        <span class="feature-icon">&#x1F9EA;</span>
        <h3>FrameSimulator</h3>
        <p>Synthetic scene engine for tests. 3D LED positions, camera paths, occluders, noise injection. Generates annotated PNG and video artifacts for every test run.</p>
      </div>
    </div>
  </div>
</section>

<footer>
  <div class="links">
    <a href="system-diagram.html">Architecture Diagram</a>
    <a href="spec.html">Technical Specification</a>
  </div>
  Pulsar &mdash; Spatial LED Mapping System
</footer>

<script>
// Scroll-triggered fade-in
const obs = new IntersectionObserver((entries) => {
  entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('visible'); } });
}, { threshold: 0.15 });
document.querySelectorAll('.fade-in').forEach(el => obs.observe(el));
</script>

</body>
</html>
